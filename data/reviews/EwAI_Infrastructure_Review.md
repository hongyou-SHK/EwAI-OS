# EwAI 智能体基础设施构建复盘

> **日期**: 2026-01-03
> **主题**: 打造跨设备、可迁移的个人化 AI 记忆系统
> **核心标签**: #Infrastructure #AI_Agent #Linux_Command #Productivity

## 1. 核心理念：数据主权与“唯一真理源”

在构建能够长期陪伴的 AI 智能体时，我们遵循了 **SSOT (Single Source of Truth)** 原则。

*   **问题**：如果把个人画像（Profile）分散在每个项目的文件夹里，修改一次需要改 N 个地方。
*   **解法**：建立一个“中央大脑”（`EwAI-OS` 文件夹），并将其托管在云同步盘（WPS/iCloud/GitHub）中。
*   **意义**：无论换电脑还是换账号，只要云盘同步了，你的“数字灵魂”就还在。

## 2. 关键技术概念

### 2.1 `.agent` 文件夹
*   **定义**：Antigravity 系统识别项目配置的入口。
*   **作用**：就像是给 AI 戴的“有色眼镜”。文件夹里有什么指令，AI 就按什么风格（幽默、严谨、类比）来看待这个项目。
*   **结构**：通常包含 `instructions.md`（行为准则）和自定义 `workflows/`（自动化脚本）。

### 2.2 软链接 (Symbolic Link / `ln -s`)
*   **定义**：文件系统层面的“超级快捷方式”。
*   **命令**：`ln -s [源文件] [目标位置]`
*   **在本项目中的应用**：
    *   我们不“复制”大脑到新项目，而是“链接”大脑。
    *   **类比**：给新房子（新项目）拉一根光纤（软链接）直通中央数据中心（WPS）。光纤本身不占地方，但能实时传输最新的数据。

### 2.3 隐藏文件 (Dotfiles)
*   **定义**：以 `.` 开头的文件或目录（如 `.agent`, `.zshrc`）。
*   **作用**：为了视觉洁癖和防误触。就像家里装修把电线埋在墙里，平时看不见，但起着决定性作用。

### 2.4 别名 (Alias) 与 脚本 (Script)
*   **Alias**：给长命令起个“绰号”。(例如把 `ls -lah` 叫 `ll`)。
    *   *局限*：跨平台能力差，逻辑简单。
*   **Script (`.sh`)**：封装了判断逻辑的小程序。
    *   *权限管理 (`chmod +x`)*：脚本写好后默认只是文本，必须赋予“可执行权限”才能运行。
    *   *优势*：可以处理复杂情况。我们最终用 `ewai-init` 脚本替代了别名。
*   **环境加载 (`source`)**：
    *   修改了配置文件（如 `.zshrc`）后，系统不会自动知晓。
    *   执行 `source ~/.zshrc` 相当于告诉系统：“重新加载一下这张地图”，让新配置立即生效。

### 2.5 相对路径与文件引用
*   **概念**：`./` 代表当前目录，`../` 代表上级目录。
*   **实战**：当我们将 `hongyou_profile.md` 从外层移入 `.agent` 内部时，必须同步修改 `instructions.md` 中的引用路径（从 `../` 改为 `./`），否则链接会断开。这是维护项目结构的细节基本功。

## 3. 架构演进与避坑指南

### 3.1 认知的“悖论”
*   **陷阱**：原本设想在一个空文件夹里运行 AI 的初始化 Workflow。
*   **真相**：AI 是“看菜吃饭”的。如果文件夹是空的（没有 `.agent`），AI 就不知道这里有 Workflow，也就无法执行初始化。
*   **修正**：必须先在物理层面（OS层）建立连接（运行 `ewai-init`），AI 进场后才能“觉醒”。

### 3.2 冷启动优化 (Cognitive Patch)
*   **现象**：刚连好大脑，问 AI “我是谁”，它可能还在发懵，因为它还没来得及读新文件。
*   **对策**：不要尬聊。直接在新项目里 **下达具体任务**（“开始分析食谱”）。任务会强制 AI 扫描上下文，从而顺带读取到 `instructions.md`，实现“隐式唤醒”。

### 3.3 数据与逻辑解耦
*   **做法**：
    *   `hongyou_profile.md`：存**数据**（Ikigai、家庭、技能）。
    *   `instructions.md`：存**逻辑**（如何调用数据、沟通风格）。
*   **优化**：最终我们将 Profile 移入 `.agent` 内部，确保一次链接，逻辑与数据同时到位。

### 3.4 系统交互特性：缓存与刷新
*   **现象**：执行了文件移动 (`mv`) 操作后，AI 依然看不到变化，甚至认为工作流“消失”了。
*   **原理**：Antigravity 系统为了性能，会对目录结构进行**短暂缓存 (System Cache)**。
*   **对策**：就像修电视一样，“重启”解决 90% 的问题。在浏览器端刷新页面或重开 Tab，强制 AI 重新扫描文件系统。

### 3.5 设计哲学：奥卡姆剃刀 (Occam's Razor)
*   **原则**：“如无必要，勿增实体。”
*   **应用**：我们最终删除了 `connect` Workflow。
    *   *理由*：既然物理软链接 (`ln -s`) 已经实现了连接，再搞一个工作流去执行连接就是多余的“实体”。架构越简单，越不容易出错。

## 4. 最终落地工具：`ewai-init`

我们封装了一个自动化脚本 `/Users/mac/WPSSyncdisk/EwAI-OS/ewai-init.sh`。

**脚本逻辑流**：
1.  **探测**：我是谁？（获取当前系统用户名）
2.  **定位**：大脑在哪？（定位 WPS 目录）
3.  **检查**：这个项目连过了吗？（防止重复运行）
4.  **执行**：建立软链接。
5.  **反馈**：告诉用户“进化合伙人已就绪”。

---
*Generated by Antigravity (EwAI Partner) for Hongyou's Knowledge Base.*
