#!/bin/bash

# ==============================================================================
# EwAI 智能体初始化脚本 (ewai-init)
# 作用：在当前项目目录建立到 "EwAI-OS" 核心配置的链接
# ==============================================================================

# 1. 自动探测 WPS 路径 (适配当前用户的用户名)
# ------------------------------------------------------------------------------
# 尝试标准路径
WPS_PATH="/Users/$(whoami)/WPSSyncdisk/EwAI-OS"

# 2. 检查源路径是否存在
# ------------------------------------------------------------------------------
if [ ! -d "$WPS_PATH" ]; then
    echo "❌ 错误：在 [$WPS_PATH] 未找到 EwAI 大脑核心目录。"
    echo "💡 请检查 WPS 同步盘是否已挂载，或手动修改脚本中的 WPS_PATH。"
    exit 1
fi

# 3. 检查当前目录是否已经是链接 (防止重复执行)
# ------------------------------------------------------------------------------
if [ -L "./.agent" ]; then
    echo "⚠️  当前项目已经包含 .agent 链接，无需重复初始化。"
    ls -l ./.agent
    exit 0
fi

# 4. 执行链接 (核心动作)
# ------------------------------------------------------------------------------
echo "🚀 正在链接 EwAI 大脑..."

# -s: 软链接
# -f: 强制 (如果存在非目录的同名文件则覆盖，不过我们前面已检查)
ln -sf "$WPS_PATH/.agent" ./.agent

# 5. 验证结果
# ------------------------------------------------------------------------------
if [ -L "./.agent" ]; then
    echo "✅ 初始化成功！"
    echo "📂 当前项目已接入：$WPS_PATH/.agent"
    echo "🤖 你的 'EwAI 进化合伙人' 已就绪。"
else
    echo "❌ 链接创建失败，请检查权限。"
    exit 1
fi
